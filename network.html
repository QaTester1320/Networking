<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Networking Quest: An Interactive Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Dark Mode Matte Aesthetic --- */
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Dark Slate */
            color: #D1D5DB; /* Light Gray */
            overflow-x: hidden;
        }
        .matte-blue { background-color: #374151; border-left: 4px solid #3B82F6; }
        .matte-green { background-color: #374151; border-left: 4px solid #10B981; }
        .matte-yellow { background-color: #374151; border-left: 4px solid #F59E0B; }
        .matte-purple { background-color: #374151; border-left: 4px solid #8B5CF6; }
        .matte-pink { background-color: #374151; border-left: 4px solid #EC4899; }
        .matte-teal { background-color: #374151; border-left: 4px solid #14B8A6; }
        .matte-red { background-color: #374151; border-left: 4px solid #EF4444; }

        .card {
            background-color: #1F2937;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #374151;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 25px -5px rgba(59, 130, 246, 0.15);
            border-color: #3B82F6;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease;
            color: white;
            display: inline-block;
            text-align: center;
        }
        .btn-primary { background-color: #3B82F6; }
        .btn-primary:hover { background-color: #2563EB; transform: scale(1.05); }
        .btn-secondary { background-color: #4B5563; }
        .btn-secondary:hover { background-color: #6B7280; }

        /* Accordion Styles */
        details > summary {
            list-style: none;
            cursor: pointer;
            padding: 1.5rem;
            background-color: #1F2937;
            border-radius: 0.75rem;
            transition: background-color 0.2s;
            font-size: 1.5rem;
            font-weight: 700;
        }
        details > summary::-webkit-details-marker { display: none; }
        details > summary:hover { background-color: #374151; }
        details[open] > summary {
            background-color: #374151;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        .details-content {
            padding: 1.5rem;
            background-color: #1F2937;
            border-top: 1px solid #4B5563;
            border-bottom-left-radius: 0.75rem;
            border-bottom-right-radius: 0.75rem;
        }
        
        /* Deep Dive Lab Styles */
        .lab-container {
            border: 2px dashed #4B5563;
            background-color: #111827;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin-top: 1.5rem;
        }

        /* --- Modal Dark Mode --- */
        .modal {
            display: none; position: fixed; z-index: 100; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0,0,0,0.8);
            animation: fadeIn 0.3s;
        }
        .modal-content {
            background-color: #1F2937;
            border: 1px solid #374151;
            margin: 10% auto; padding: 2rem; border-radius: 1rem;
            width: 90%; max-width: 600px; text-align: left;
            animation: slideIn 0.3s;
            color: #D1D5DB;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- WORKING Animated Diagram --- */
        .diagram-container {
            position: relative;
            height: 150px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .diagram-box {
            border: 2px solid #4B5563;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            position: relative;
            background-color: #374151;
            width: 22%;
            z-index: 2;
        }
        .packet {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 11%;
            transform: translateY(-50%);
            z-index: 3;
            opacity: 0;
        }
        .dns-packet {
            background-color: #A78BFA; /* Purple */
            box-shadow: 0 0 10px #A78BFA;
            animation: movePacketToDNS 4s linear infinite 0s;
        }
        .web-packet {
            background-color: #FBBF24; /* Yellow */
            box-shadow: 0 0 10px #FBBF24;
            animation: movePacketToWeb 4s linear infinite 4s;
        }
        @keyframes movePacketToDNS {
            0% { left: 11%; opacity: 0; }
            10% { opacity: 1; }
            80% { left: 61%; opacity: 1; }
            90% { opacity: 0; }
            100% { left: 61%; opacity: 0; }
        }
        @keyframes movePacketToWeb {
            0% { left: 11%; opacity: 0; }
            10% { opacity: 1; }
            80% { left: 86%; opacity: 1; }
            90% { opacity: 0; }
            100% { left: 86%; opacity: 0; }
        }
        .text-gradient {
             background-image: linear-gradient(to right, #3B82F6, #14B8A6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* Intro SVG Animation */
        #intro-svg .circle { animation: pulse 2s infinite ease-in-out; }
        #intro-svg .line { stroke-dasharray: 100; stroke-dashoffset: 100; animation: draw 3s ease-out forwards; }
        @keyframes pulse { 0%, 100% { transform: scale(0.95); opacity: 0.8; } 50% { transform: scale(1.05); opacity: 1; } }
        @keyframes draw { to { stroke-dashoffset: 0; } }
        
        /* Clickable Layer Style */
        .clickable-layer {
            cursor: pointer;
            transition: transform 0.2s ease, filter 0.2s ease;
        }
        .clickable-layer:hover {
            transform: scale(1.05);
            filter: brightness(1.2);
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header -->
    <header class="text-center p-8 bg-[#1F2937] border-b border-[#374151]">
        <h1 class="text-4xl md:text-5xl font-bold text-gradient">Networking Quest</h1>
        <p class="text-lg text-gray-400 mt-2">Your Adventure into the Digital World!</p>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4 md:p-8 space-y-16">

        <!-- Introduction -->
        <section class="text-center">
            <h2 class="text-3xl font-bold mb-4">Welcome, Digital Explorer!</h2>
            <p class="max-w-3xl mx-auto text-gray-300">
                Ever wondered how your computer talks to the internet? It's not magic, it's networking! This guide is your ultimate quest, taking you from the core concepts to advanced, real-world applications with hands-on labs and games.
            </p>
             <div class="mt-6">
                <svg id="intro-svg" viewBox="0 0 400 200" class="mx-auto w-full max-w-lg">
                    <defs><radialGradient id="grad1" cx="50%" cy="50%" r="50%" fx="50%" fy="50%"><stop offset="0%" style="stop-color:rgb(59,130,246);stop-opacity:1" /><stop offset="100%" style="stop-color:rgb(37,99,235);stop-opacity:0" /></radialGradient></defs>
                    <g fill="url(#grad1)">
                        <circle class="circle" cx="50" cy="100" r="15" style="animation-delay: 0s;"></circle>
                        <circle class="circle" cx="150" cy="50" r="10" style="animation-delay: 0.2s;"></circle>
                        <circle class="circle" cx="150" cy="150" r="10" style="animation-delay: 0.4s;"></circle>
                        <circle class="circle" cx="250" cy="50" r="10" style="animation-delay: 0.6s;"></circle>
                        <circle class="circle" cx="250" cy="150" r="10" style="animation-delay: 0.8s;"></circle>
                        <circle class="circle" cx="350" cy="100" r="15" style="animation-delay: 1s;"></circle>
                    </g>
                    <g stroke="#4B5563" stroke-width="2">
                        <line class="line" x1="65" y1="100" x2="140" y2="55" style="animation-delay: 0.5s;"></line>
                        <line class="line" x1="65" y1="100" x2="140" y2="145" style="animation-delay: 0.7s;"></line>
                        <line class="line" x1="160" y1="50" x2="240" y2="50" style="animation-delay: 0.9s;"></line>
                        <line class="line" x1="160" y1="150" x2="240" y2="150" style="animation-delay: 1.1s;"></line>
                        <line class="line" x1="260" y1="55" x2="335" y2="100" style="animation-delay: 1.3s;"></line>
                        <line class="line" x1="260" y1="145" x2="335" y2="100" style="animation-delay: 1.5s;"></line>
                    </g>
                    <text x="200" y="110" font-family="Inter, sans-serif" font-size="20" fill="#D1D5DB" text-anchor="middle" style="animation: fadeIn 2s ease-in forwards; opacity:0;">Connecting the World</text>
                </svg>
            </div>
        </section>

        <!-- RESTORED Main Learning Sections -->
        <section class="space-y-8">
             <h2 class="text-3xl font-bold text-center mb-4">Your Learning Quest</h2>
            <!-- Core Concepts Section -->
            <details open>
                <summary>I. Core Networking Concepts</summary>
                <div class="details-content space-y-12">
                    <!-- OSI Model Card -->
                    <div id="main-osi" class="card">
                        <h3 class="text-xl font-bold mb-4 text-gradient">OSI Model: The 7 Layers of Communication</h3>
                        <p class="text-gray-300 mb-4">The OSI Model is a conceptual framework that standardizes how different network hardware and software communicate. Think of it as the detailed, step-by-step process of ordering a pizza online, from clicking "Place Order" to the pizza arriving at your door. Each layer has a specific job, and they all work together seamlessly.</p>
                        <div class="space-y-6 mt-6">
                            <div class="matte-purple p-4 rounded-lg">
                                <h4 class="font-bold text-lg text-white">Layer 7: Application Layer</h4>
                                <p class="text-sm mt-1"><strong>The Analogy:</strong> The restaurant's online menu or food delivery app. It's the interface you directly interact with to choose your pizza and toppings.</p>
                                <p class="text-sm mt-2"><strong>In-Depth:</strong> This is the layer closest to you, the end-user. It provides the interface for applications to access network services. It's not the application itself (like Chrome or Outlook), but the protocols that these applications use to communicate. When you browse a website, your browser is using the Hypertext Transfer Protocol (HTTP or HTTPS), which lives at this layer.</p>
                                <p class="text-xs mt-2 text-gray-400"><strong>Protocols:</strong> HTTP, HTTPS, FTP (File Transfer), SMTP (Email), DNS.</p>
                            </div>
                            <div class="matte-pink p-4 rounded-lg">
                                <h4 class="font-bold text-lg text-white">Layer 6: Presentation Layer</h4>
                                <p class="text-sm mt-1"><strong>The Analogy:</strong> The app translates your "Large Pepperoni" order into a standardized kitchen code (e.g., "LP-12-PPRN") that any of the restaurant's chefs can understand, regardless of what language they speak.</p>
                                <p class="text-sm mt-2"><strong>In-Depth:</strong> This layer is the universal translator. It takes the data from the Application Layer and converts it into a standard format that the receiving computer can understand. It also handles two other critical jobs: encryption (scrambling your data for security) and compression (making the data smaller to send it faster). When you see the lock icon in your browser, this is the layer that's encrypting your data before it's sent.</p>
                                <p class="text-xs mt-2 text-gray-400"><strong>Functions:</strong> Data Encryption/Decryption, Compression, Character Set Translation (e.g., ASCII to UTF-8).</p>
                            </div>
                            <div class="matte-teal p-4 rounded-lg">
                                <h4 class="font-bold text-lg text-white">Layer 5: Session Layer</h4>
                                <p class="text-sm mt-1"><strong>The Analogy:</strong> The waiter who takes your order, confirms the kitchen is ready, keeps your table's tab open for the whole meal, and closes it out when you pay.</p>
                                <p class="text-sm mt-2"><strong>In-Depth:</strong> This layer is the conversation manager. It's responsible for creating, maintaining, and tearing down the communication channel (the "session") between two devices. It ensures that the conversation stays in sync, placing checkpoints in large data transfers. If the connection drops while downloading a big file, the session layer allows the download to resume from the last checkpoint instead of starting all over again.</p>
                                <p class="text-xs mt-2 text-gray-400"><strong>Functions:</strong> Session establishment, maintenance, termination, authentication, and authorization.</p>
                            </div>
                            <div class="matte-blue p-4 rounded-lg">
                                <h4 class="font-bold text-lg text-white">Layer 4: Transport Layer</h4>
                                <p class="text-sm mt-1"><strong>The Analogy:</strong> The restaurant's quality control manager who decides *how* to send your order. For a full meal, they use a guaranteed, tracked delivery service (TCP). For just a drink, they might use a fast, untracked courier (UDP).</p>
                                <p class="text-sm mt-2"><strong>In-Depth:</strong> This layer provides end-to-end communication and reliability. It chops the data from the upper layers into smaller pieces called "segments." Its main job is to ensure those segments get to the other end correctly. The two main protocols here are TCP (Transmission Control Protocol), which is reliable and checks for errors, and UDP (User Datagram Protocol), which is fast but doesn't guarantee delivery. Web browsing uses TCP; video streaming and online games often use UDP.</p>
                                <p class="text-xs mt-2 text-gray-400"><strong>Protocols:</strong> TCP (Reliable), UDP (Fast).</p>
                            </div>
                            <div class="matte-green p-4 rounded-lg">
                                <h4 class="font-bold text-lg text-white">Layer 3: Network Layer</h4>
                                <p class="text-sm mt-1"><strong>The Analogy:</strong> The delivery driver using a GPS to find the best route across the city, navigating highways and side streets to get from the restaurant's address to your home address.</p>
                                <p class="text-sm mt-2"><strong>In-Depth:</strong> This is the traffic director of the network. It's responsible for logical addressing (IP addresses) and routing. It takes the segments from the Transport Layer and puts them into packets, adding source and destination IP addresses. Routers operate at this layer, looking at the destination IP address on each packet and deciding the best path to send it on its journey across the internet.</p>
                                <p class="text-xs mt-2 text-gray-400"><strong>Protocols/Devices:</strong> IP (Internet Protocol), Routers.</p>
                            </div>
                            <div class="matte-yellow p-4 rounded-lg">
                                <h4 class="font-bold text-lg text-white">Layer 2: Data Link Layer</h4>
                                <p class="text-sm mt-1"><strong>The Analogy:</strong> Once the driver is on your street, they look for your specific house number to make the final delivery.</p>
                                <p class="text-sm mt-2"><strong>In-Depth:</strong> This layer handles communication on the *local* network segment (like all devices connected to your home Wi-Fi). It takes the packets from the Network Layer and puts them into "frames," adding the physical hardware address (MAC address) of the next device in the chain. Network switches operate here, using MAC addresses to send data only to the intended device on the local network, which is far more efficient than a hub.</p>
                                <p class="text-xs mt-2 text-gray-400"><strong>Protocols/Devices:</strong> Ethernet, Wi-Fi, Switches, MAC Addresses.</p>
                            </div>
                            <div class="matte-red p-4 rounded-lg">
                                <h4 class="font-bold text-lg text-white">Layer 1: Physical Layer</h4>
                                <p class="text-sm mt-1"><strong>The Analogy:</strong> The actual roads, rubber tires, and gasoline the delivery car uses to move.</p>
                                <p class="text-sm mt-2"><strong>In-Depth:</strong> This is the physical stuff. It defines the hardware and the medium used to transmit the data. It's responsible for converting the digital bits (1s and 0s) into physical signals—electrical pulses for copper Ethernet cables, light pulses for fiber optic cables, or radio waves for Wi-Fi. It's all about the physics of getting the data from one place to another.</p>
                                <p class="text-xs mt-2 text-gray-400"><strong>Hardware:</strong> Cables, Hubs, Antennas, Network Interface Cards (NICs).</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- NEW DETAILED SECTIONS FOR CORE CONCEPTS -->
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-gradient">TCP/IP Protocol Suite</h3>
                        <p class="text-gray-300 mb-4">While the OSI model is a 7-layer theoretical guide, the TCP/IP suite is the 4-layer practical model that the internet actually runs on. It's the real-world implementation.</p>
                        <div class="matte-teal p-4 rounded-lg">
                           <h4 class="font-bold text-lg text-white">The Handshake: How TCP Starts a Conversation</h4>
                           <p class="text-sm">TCP uses a "three-way handshake" to guarantee a reliable connection. 1. You send a "SYN" (Can we talk?). 2. The server replies with "SYN/ACK" (Yes, I'm ready!). 3. You reply with "ACK" (Great, here comes the data!). This prevents data from being sent to a device that isn't listening.</p>
                        </div>
                        <div class="matte-red p-4 rounded-lg mt-4">
                           <h4 class="font-bold text-lg text-white">🚨 Security Alert: Man-in-the-Middle (MitM) Attacks</h4>
                           <p class="text-sm">An attacker can intercept this handshake, pretending to be the legitimate server. This allows them to read, and even modify, all your communication. This is why encryption (HTTPS, which runs on top of TCP) is vital, as it scrambles the data so the interceptor can't understand it.</p>
                        </div>
                    </div>
                    
                    <div class="card">
                         <h3 class="text-xl font-bold mb-4 text-gradient">IP Addressing: Your Digital Location</h3>
                         <p class="text-gray-300 mb-4">An IP address is your device's unique identifier on a network. It's how data packets know their final destination. This concept is fundamental to all networking.</p>
                        <div class="bg-gray-800 p-4 rounded-lg my-6">
                            <h4 class="font-bold text-center text-white mb-4">Public vs. Private IPs: The Apartment Analogy</h4>
                            <!-- FIXED RESPONSIVE DIAGRAM -->
                            <svg viewBox="0 0 400 160" class="mx-auto w-full max-w-2xl">
                                <text x="20" y="85" font-size="40">🏠</text> <text x="5" y="125" font-size="12" fill="#D1D5DB" class="text-xs sm:text-sm">Your Home</text>
                                <text x="110" y="45" font-size="20">💻</text><text x="100" y="25" font-size="10" fill="#A78BFA">192.168.1.101</text>
                                <text x="110" y="85" font-size="20">📱</text><text x="100" y="70" font-size="10" fill="#A78BFA">192.168.1.102</text>
                                <text x="110" y="125" font-size="20">📺</text><text x="100" y="150" font-size="10" fill="#A78BFA">192.168.1.103</text>
                                <rect x="180" y="60" width="40" height="40" rx="5" fill="#3B82F6" /> <text x="190" y="85" font-size="20">📡</text><text x="175" y="50" font-size="10" fill="#3B82F6">Router</text>
                                <text x="340" y="85" font-size="40">☁️</text> <text x="325" y="125" font-size="12" fill="#D1D5DB" class="text-xs sm:text-sm">Internet</text>
                                <text x="230" y="65" font-size="10" fill="#34D399">Public IP: 203.0.113.55</text>
                                <path d="M135 45 H 180" stroke="#A78BFA" stroke-width="1" /><path d="M135 85 H 180" stroke="#A78BFA" stroke-width="1" /><path d="M135 125 H 180" stroke="#A78BFA" stroke-width="1" />
                                <path d="M220 80 H 340" stroke="#34D399" stroke-width="2" stroke-dasharray="4" />
                            </svg>
                             <p class="text-sm text-gray-400 mt-2 text-center">Your Router gets one <strong class="text-green-400">Public IP</strong> from your internet provider to talk to the internet. Inside, it gives each device a unique <strong class="text-purple-400">Private IP</strong>. This process, called NAT (Network Address Translation), is crucial for conserving the limited number of IPv4 addresses.</p>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-gradient">Network Security: The Digital Bodyguards</h3>
                        <p class="text-gray-300 mb-4">Network security involves the policies and practices adopted to prevent and monitor unauthorized access, misuse, modification, or denial of a computer network and network-accessible resources.</p>
                        <ul class="list-disc list-inside space-y-2 text-sm">
                            <li><strong>Firewalls:</strong> Act as a bouncer at a club, checking every data packet against a set of rules to decide if it's allowed into or out of your network.</li>
                            <li><strong>Encryption:</strong> Scrambles your data into an unreadable code. Anyone who intercepts it without the secret key sees only gibberish. This is what HTTPS (the 'S' stands for secure) does for your web traffic.</li>
                            <li><strong>VPNs (Virtual Private Networks):</strong> Create a secure, encrypted tunnel for your data across the public internet, making it seem like you are directly connected to a private, secure network. It's like having a private, armored convoy for your data packets.</li>
                        </ul>
                    </div>

                     <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-gradient">Network Topologies: The City Layouts</h3>
                        <p class="text-gray-300 mb-4">Topology is the arrangement of the elements (links, nodes, etc.) of a communication network. It's the blueprint for how your devices are connected.</p>
                         <div class="grid md:grid-cols-2 gap-4 text-center text-sm">
                             <div class="matte-blue p-3 rounded-lg"><strong>Star:</strong> All devices connect to a central hub (like a switch). Easy to manage, but if the hub fails, everything fails.</div>
                             <div class="matte-green p-3 rounded-lg"><strong>Bus:</strong> All devices share a single communication line. Old-school and cheap, but a break in the cable can take down the whole network.</div>
                             <div class="matte-yellow p-3 rounded-lg"><strong>Ring:</strong> Devices are connected in a circle. Data travels in one direction. It's orderly but slow, and one failed device can break the loop.</div>
                             <div class="matte-purple p-3 rounded-lg"><strong>Mesh:</strong> Devices are interconnected with many redundant connections. Very reliable and self-healing, but complex and expensive. The internet itself is a giant mesh network.</div>
                         </div>
                    </div>
                    
                     <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-gradient">Network Devices: The Traffic Controllers</h3>
                        <p class="text-gray-300 mb-4">These are the physical hardware that makes a network function.</p>
                        <ul class="list-disc list-inside space-y-2 text-sm">
                           <li><strong>Hub:</strong> A "dumb" device that just repeats any signal it receives to all other connected devices. It's like a town crier shouting everything to everyone, creating lots of unnecessary traffic.</li>
                           <li><strong>Switch:</strong> A "smart" device that learns the MAC addresses of connected devices. It sends data only to the intended recipient. It's like a mail carrier delivering letters to specific house numbers, not the whole street.</li>
                           <li><strong>Router:</strong> Connects different networks together and directs traffic between them. It's the post office sorting facility, deciding which mail needs to go to a different city (network) and which stays local.</li>
                        </ul>
                    </div>
                </div>
            </details>
            <details>
                <summary>II. Emerging & Advanced Topics</summary>
                <div class="details-content space-y-12">
                     <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-gradient">Wired vs. Wireless Networks</h3>
                        <p class="text-gray-300 mb-4">How do you connect to the internet? It's usually one of two ways: a physical cable (wired) or through the air (wireless). Both have unique strengths and weaknesses.</p>
                        <div class="grid md:grid-cols-2 gap-6 mt-6">
                            <div class="matte-blue p-4 rounded-lg">
                                <h4 class="font-bold text-lg text-white">Wired (Ethernet): The Solid Pipe</h4>
                                <p class="text-sm mt-2"><strong>Analogy:</strong> This is like the main water pipe coming into your house. It's incredibly fast, reliable, and secure because it's a closed, physical connection.<br><br><strong>In-Depth:</strong> Using an Ethernet cable provides a direct connection to your router. This results in the lowest latency (delay), the fastest possible speeds, and is not affected by interference from other devices. It's the preferred choice for tasks where stability is critical, like competitive online gaming or transferring huge files.</p>
                            </div>
                            <div class="matte-green p-4 rounded-lg">
                                <h4 class="font-bold text-lg text-white">Wireless (Wi-Fi): The Sprinkler System</h4>
                                <p class="text-sm mt-2"><strong>Analogy:</strong> This is like a sprinkler system for your garden. It provides coverage over a wide area without needing individual pipes to every plant, offering incredible convenience.<br><br><strong>In-Depth:</strong> Wi-Fi uses radio waves to transmit data. This is super convenient, allowing phones, laptops, and smart devices to connect freely. However, the signal can be weakened by walls or interference from your neighbor's Wi-Fi, microwaves, and other electronics. Modern standards like Wi-Fi 6 (802.11ax) are incredibly fast, but generally not as stable as a direct wired connection.</p>
                            </div>
                        </div>
                         <div class="matte-red p-4 rounded-lg mt-6">
                           <h4 class="font-bold text-lg text-white">🚨 Security Alert: Wi-Fi Eavesdropping</h4>
                           <p class="text-sm">Because Wi-Fi signals travel through the air, a determined attacker can potentially intercept them. This is why strong encryption like <strong class="text-white">WPA3</strong> is non-negotiable. An "open" or unencrypted Wi-Fi network is like shouting your secrets in a crowded room—anyone can listen in. Always use a strong, unique password for your Wi-Fi.</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-gradient">LAN vs. WAN</h3>
                        <p class="text-gray-300 mb-4">Not all networks are the same size. The terms LAN and WAN define the scope of the network, from a single room to the entire globe.</p>
                        <div class="bg-gray-800 p-4 rounded-lg my-6">
                            <h4 class="font-bold text-center text-white mb-4">LAN vs. WAN Visualization</h4>
                             <svg viewBox="0 0 400 150" class="w-full max-w-3xl mx-auto"><rect x="10" y="25" width="150" height="100" rx="10" stroke="#3B82F6" stroke-width="2" fill="rgba(59,130,246,0.1)"></rect><text x="40" y="80" fill="#3B82F6" font-weight="bold" class="text-sm sm:text-base">LAN 1 (Office)</text><circle cx="50" cy="50" r="5" fill="#D1D5DB"></circle><circle cx="80" cy="90" r="5" fill="#D1D5DB"></circle><circle cx="120" cy="60" r="5" fill="#D1D5DB"></circle><rect x="240" y="25" width="150" height="100" rx="10" stroke="#10B981" stroke-width="2" fill="rgba(16,185,129,0.1)"></rect><text x="270" y="80" fill="#10B981" font-weight="bold" class="text-sm sm:text-base">LAN 2 (Home)</text><circle cx="280" cy="50" r="5" fill="#D1D5DB"></circle><circle cx="310" cy="90" r="5" fill="#D1D5DB"></circle><circle cx="350" cy="60" r="5" fill="#D1D5DB"></circle><path d="M160 75 Q 200 20 240 75" stroke="#D1D5DB" stroke-width="2" fill="none" stroke-dasharray="5"></path><text x="165" y="60" fill="#D1D5DB" font-size="12">WAN (The Internet)</text></svg>
                        </div>
                        <div class="grid md:grid-cols-2 gap-6 mt-6">
                            <div class="matte-blue p-4 rounded-lg">
                                <h4 class="font-bold text-lg text-white">LAN (Local Area Network)</h4>
                                <p class="text-sm mt-2"><strong>Analogy:</strong> Your immediate family inside your house. You can all talk to each other easily and directly without needing to make a long-distance call.<br><br><strong>In-Depth:</strong> A LAN covers a small geographical area like a home, office, or a single building. The devices are all connected to the same networking equipment (like one router/switch). Communication within a LAN is extremely fast. You own and manage the equipment yourself.</p>
                            </div>
                            <div class="matte-green p-4 rounded-lg">
                                <h4 class="font-bold text-lg text-white">WAN (Wide Area Network)</h4>
                                <p class="text-sm mt-2"><strong>Analogy:</strong> Your extended family spread across the country. To talk to them, you need to use the national telephone system (a WAN).<br><br><strong>In-Depth:</strong> A WAN connects multiple LANs over a large geographical area. The internet is the world's largest WAN. Businesses use WANs to connect their headquarters to branch offices in other cities. These connections are typically leased from telecommunication companies and are slower and more expensive than LAN connections.</p>
                            </div>
                        </div>
                    </div>
                     <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-gradient">Internet of Things (IoT)</h3>
                        <p class="text-gray-300 mb-4">This is the vast network of physical objects embedded with sensors and software, all connected to the internet. From your smartwatch tracking your steps to a smart fridge telling you you're out of milk, IoT devices are constantly collecting and sharing data to make our lives more convenient and efficient.</p>
                         <div class="matte-red p-4 rounded-lg mt-4">
                           <h4 class="font-bold text-lg text-white">🚨 Security Alert: The Weakest Link</h4>
                           <p class="text-sm">IoT devices are a huge target for hackers because they often have poor security (like default, unchangeable passwords). A hacked smart camera could spy on you, or thousands of hacked devices could be used together in a "botnet" to launch massive Distributed Denial of Service (DDoS) attacks that take down major websites.</p>
                        </div>
                    </div>
                     <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-gradient">Software-Defined Networking (SDN)</h3>
                        <p class="text-gray-300 mb-4">Traditionally, each network device (like a router) has its own brain (control plane) to make decisions. SDN separates the "brain" from the "body" (data plane). A central software controller acts as the brain for the whole network, making it more flexible, programmable, and easier to manage. It's the difference between each car navigating on its own versus a central, AI-powered traffic control system managing the entire city's flow in real-time.</p>
                    </div>
                     <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-gradient">Network Function Virtualization (NFV)</h3>
                        <p class="text-gray-300 mb-4">Imagine you need a firewall, a load balancer, and a WAN optimizer. In the past, you'd have to buy three separate, expensive physical boxes. NFV lets you run all these network functions as software (virtual machines) on standard, off-the-shelf servers. It's like instead of buying a separate DVD player, CD player, and VCR, you just run different media apps on your computer. This makes networks cheaper, faster to deploy, and much more flexible.</p>
                    </div>
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-gradient">Machine Learning & AI in Networking</h3>
                        <p class="text-gray-300 mb-4">Networks are becoming too complex for humans to manage alone. AI and ML are stepping in to be the super-intelligent network managers. They can predict traffic jams before they happen and re-route data, detect subtle signs of a cyberattack that a human would miss, and automatically heal the network when a device fails. It's like having a team of brilliant engineers watching over your network 24/7.</p>
                    </div>
                    <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-gradient">Cloud Networking</h3>
                        <p class="text-gray-300 mb-4">Instead of buying and managing your own servers in a closet, you rent computing power from massive data centers run by Amazon (AWS), Google (GCP), or Microsoft (Azure). Cloud networking is the set of tools and technologies used to connect your users and offices to these cloud resources securely and efficiently. It's like building a secure, private monorail system from your office directly to your rented space in the cloud, bypassing public traffic.</p>
                    </div>
                     <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-gradient">5G/6G Technologies</h3>
                        <p class="text-gray-300 mb-4">5G isn't just "faster 4G." It's a revolutionary leap in three areas: blazing-fast speed (eMBB), ultra-low latency (URLLC), and massive connectivity (mMTC). This enables things like self-driving cars that communicate instantly, surgeons performing remote operations with robotic arms, and smart cities with millions of connected sensors. 6G will push this even further, potentially integrating space-based networks and even sensing capabilities.</p>
                    </div>
                     <div class="card">
                        <h3 class="text-xl font-bold mb-4 text-gradient">Blockchain in Networking</h3>
                        <p class="text-gray-300 mb-4">Blockchain offers a decentralized, tamper-proof way to record information. In networking, this can be used to create secure and trusted systems without a central authority. For example, it can be used for managing domain names (to prevent hijacking), creating secure roaming agreements between telecom providers, or validating the identity of IoT devices to prevent unauthorized access. It's like having a public, unchangeable notary for all network transactions.</p>
                    </div>
                </div>
            </details>
            <details>
                <summary>III. Specific Applications and Technologies</summary>
                <div class="details-content space-y-12">
                    <p>See how networking principles are applied in specialized, real-world scenarios. Dive into the labs below for hands-on experience!</p>
                </div>
            </details>
        </section>


        <!-- How it all works together -->
        <section>
            <h2 class="text-3xl font-bold text-center mb-6">Let's Trace a Packet!</h2>
            <div class="card">
                <p class="text-center text-gray-400 mb-6">Watch the purple DNS request packet, then the yellow web data packet!</p>
                <div class="diagram-container">
                    <div class="packet dns-packet"></div>
                    <div class="packet web-packet"></div>
                    <div class="diagram-box"><strong>Your PC</strong><br/><span class="text-xs">192.168.1.10</span></div>
                    <div class="diagram-box"><strong>Gateway</strong><br/><span class="text-xs">192.168.1.1</span></div>
                    <div class="diagram-box"><strong>DNS Server</strong><br/><span class="text-xs">8.8.8.8</span></div>
                    <div class="diagram-box"><strong>Website</strong><br/><span class="text-xs">104.26.10.18</span></div>
                </div>
                <ol class="list-decimal list-inside mt-6 space-y-2 text-gray-300">
                    <li>Your PC wants `cool-website.com`. It needs the IP! It sends a <strong class="text-purple-400">DNS request</strong> (purple packet) to the <strong>DNS Server</strong>.</li>
                    <li>The DNS server finds and returns the IP: `104.26.10.18`.</li>
                    <li>Your PC creates data <strong>Packets</strong> (yellow packet) addressed to `104.26.10.18` on a specific <strong>Port</strong> (e.g., 443 for HTTPS).</li>
                    <li>Packets are sent through your <strong>Gateway</strong> to the website.</li>
                </ol>
            </div>
        </section>

        <!-- Games Section -->
        <section id="games" class="text-center">
            <h2 class="text-3xl font-bold text-center mb-4">Time to Play & Learn!</h2>
            <p class="max-w-2xl mx-auto text-gray-400 mb-8">Test your new skills with these fun mini-games. Select a game to begin!</p>
            <div id="game-container" class="card text-left">
                <h3 class="text-2xl font-semibold text-center">Welcome to the Arcade!</h3>
                <p class="text-gray-400 mt-2 text-center">Choose a game below to start playing.</p>
            </div>
            <div class="flex flex-wrap justify-center gap-4 mt-6">
                <button class="btn btn-primary" onclick="loadGame(1)">1. DNS Cache Hunt</button>
                <button class="btn btn-primary" onclick="loadGame(2)">2. IP Sorter</button>
                <button class="btn btn-primary" onclick="loadGame(3)">3. Subnet Sandbox</button>
                <button class="btn btn-primary" onclick="loadGame(4)">4. MAC Match-Up</button>
                <button class="btn btn-primary" onclick="loadGame(5)">5. Port Master</button>
                <button class="btn btn-primary" onclick="loadGame(6)">6. Firewall Challenge</button>
            </div>
        </section>
        
        <!-- DEEP DIVE LABS SECTION (AFTER ARCADE) -->
        <section id="deep-dives" class="space-y-16">
            <h2 class="text-4xl font-bold text-center text-gradient">Deep Dive Labs</h2>
            <p class="text-center text-gray-400">This is where the real training begins! Each topic has its own lab with in-depth info and a hands-on exercise.</p>
            
            <!-- OSI Model Lab -->
            <article id="lab-osi" class="card">
                <h3 class="text-3xl font-bold mb-4">Lab: The OSI Model</h3>
                 <p class="text-gray-300 mb-4">Here we'll reinforce the concepts of the OSI model with a hands-on exercise.</p>
                 <div class="lab-container">
                    <h4 class="text-xl font-bold text-center text-yellow-400">Practical Lab: Match the Protocol!</h4>
                    <p class="text-sm text-center text-gray-400 mb-4">Drag the protocol or technology to the correct OSI layer it operates on.</p>
                    <div id="osi-lab-source" class="flex flex-wrap justify-center gap-4 p-4 bg-gray-900 rounded-lg min-h-[60px]">
                        <div draggable="true" class="p-2 bg-gray-700 rounded cursor-grab">HTTP</div>
                        <div draggable="true" class="p-2 bg-gray-700 rounded cursor-grab">TCP</div>
                        <div draggable="true" class="p-2 bg-gray-700 rounded cursor-grab">IP</div>
                        <div draggable="true" class="p-2 bg-gray-700 rounded cursor-grab">Ethernet</div>
                        <div draggable="true" class="p-2 bg-gray-700 rounded cursor-grab">Wi-Fi Signals</div>
                    </div>
                    <div id="osi-lab-buckets" class="grid grid-cols-1 md:grid-cols-5 gap-2 mt-4 text-center text-xs">
                        <div class="p-2 matte-red min-h-[60px]" data-layer="Physical">Layer 1: Physical</div>
                        <div class="p-2 matte-yellow min-h-[60px]" data-layer="Data Link">Layer 2: Data Link</div>
                        <div class="p-2 matte-green min-h-[60px]" data-layer="Network">Layer 3: Network</div>
                        <div class="p-2 matte-blue min-h-[60px]" data-layer="Transport">Layer 4: Transport</div>
                        <div class="p-2 matte-purple min-h-[60px]" data-layer="Application">Layer 7: Application</div>
                    </div>
                     <p id="osi-lab-feedback" class="text-center mt-4 h-4"></p>
                </div>
            </article>

            <!-- IP Addressing Lab -->
            <article id="lab-ip" class="card">
                <h3 class="text-3xl font-bold mb-4">Lab: IP Addressing & Subnetting</h3>
                 <div class="lab-container">
                    <h4 class="text-xl font-bold text-center text-yellow-400">Practical Lab: Subnet Calculator</h4>
                    <p class="text-sm text-center text-gray-400 mb-4">Enter an IP address and a CIDR prefix (e.g., /24) to see the network details.</p>
                    <div class="flex flex-wrap justify-center gap-4">
                        <input type="text" id="ip-calc-input" placeholder="e.g., 192.168.1.100" class="p-2 rounded bg-gray-700 border border-gray-600">
                        <input type="number" id="ip-calc-cidr" placeholder="/24" min="0" max="32" class="p-2 rounded bg-gray-700 border border-gray-600 w-20">
                        <button onclick="calculateSubnet()" class="btn btn-primary">Calculate</button>
                    </div>
                    <div id="ip-calc-results" class="mt-4 p-4 bg-gray-900 rounded-lg text-sm whitespace-pre-wrap font-mono"></div>
                </div>
            </article>

            <!-- Packet Trace Lab -->
            <article id="lab-packet-trace" class="card">
                <h3 class="text-3xl font-bold mb-4">Real-World Lab: Packet Trace Analysis</h3>
                <p class="text-gray-300 mb-4">This is the ultimate challenge! You've used a network analyzer like Wireshark to "capture" a raw data packet traveling from a user's PC to a web server. Your mission is to dissect it, layer by layer, to understand the full story of this communication. It's like being a digital detective!</p>
                <div class="lab-container">
                    <h4 class="text-xl font-bold text-center text-yellow-400">Captured Packet Data</h4>
                    <div class="mt-4 p-4 bg-gray-900 rounded-lg font-mono text-xs text-gray-400 overflow-x-auto">
                        <p><span class="text-yellow-400">[Ethernet Frame]</span></p>
                        <p class="pl-4">Dest MAC: <span class="text-white">1A:2B:3C:4D:5E:6F (Router)</span> | Source MAC: <span class="text-white">AA:BB:CC:11:22:33 (Your PC)</span></p>
                        <div class="mt-2 p-4 bg-gray-800 rounded-lg">
                            <p><span class="text-green-400">[IP Packet]</span></p>
                            <p class="pl-4">Source IP: <span class="text-white">192.168.1.101</span> | Dest IP: <span class="text-white">93.184.216.34</span> | Protocol: <span class="text-white">TCP</span></p>
                            <div class="mt-2 p-4 bg-gray-700 rounded-lg">
                                <p><span class="text-blue-400">[TCP Segment]</span></p>
                                <p class="pl-4">Source Port: <span class="text-white">51234</span> | Dest Port: <span class="text-white">80</span> | Flags: <span class="text-white">[SYN]</span></p>
                                <div class="mt-2 p-4 bg-gray-600 rounded-lg">
                                    <p><span class="text-purple-400">[Application Data]</span></p>
                                    <p class="pl-4 text-white">GET /index.html HTTP/1.1</p>
                                    <p class="pl-4 text-white">Host: example.com</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h4 class="text-xl font-bold text-center text-yellow-400 mt-6">Your Analysis</h4>
                    <p class="text-sm text-center text-gray-400 mb-4">Examine the captured data above and fill in the blanks below.</p>
                    <div class="grid md:grid-cols-2 gap-6" id="trace-analysis-grid">
                        <!-- Questions will be dynamically inserted here -->
                    </div>
                    <button onclick="checkPacketTrace()" class="btn btn-primary w-full mt-6">Check My Analysis</button>
                </div>
            </article>
            
            <!-- FUNDAMENTALS DEEP DIVE SECTION -->
            <article id="lab-fundamentals" class="card">
                <h3 class="text-3xl font-bold mb-4">Fundamentals Deep Dive</h3>
                <p class="text-gray-300 mb-4">Before you take on the final challenge, let's solidify your understanding of the core building blocks of any network. This section provides a fun, detailed exploration of key concepts with interactive visuals.</p>

                <!-- Topologies Sub-section -->
                <div class="lab-container">
                    <h4 class="text-xl font-bold text-center text-yellow-400">Network Topologies: The Blueprints of Connection</h4>
                    <p class="text-sm text-center text-gray-400 mb-6">A topology is the virtual shape or structure of a network. It's the master plan for how all the devices will be connected. Let's explore the most common blueprints!</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Star Topology -->
                        <div class="bg-gray-800 p-4 rounded-lg text-center">
                             <svg viewBox="0 0 100 80" class="w-24 h-24 mx-auto mb-2"><circle cx="50" cy="40" r="10" fill="#3B82F6"></circle><circle cx="20" cy="15" r="5" fill="#D1D5DB"></circle><circle cx="80" cy="15" r="5" fill="#D1D5DB"></circle><circle cx="20" cy="65" r="5" fill="#D1D5DB"></circle><circle cx="80" cy="65" r="5" fill="#D1D5DB"></circle><path d="M50 40 L 20 15" stroke="#4B5563" stroke-width="1.5"></path><path d="M50 40 L 80 15" stroke="#4B5563" stroke-width="1.5"></path><path d="M50 40 L 20 65" stroke="#4B5563" stroke-width="1.5"></path><path d="M50 40 L 80 65" stroke="#4B5563" stroke-width="1.5"></path></svg>
                            <h5 class="font-bold text-lg">Star</h5>
                            <p class="text-xs text-gray-400 mt-2"><strong>Analogy:</strong> An airport hub. All planes (devices) connect to the central control tower (switch/hub).<br><strong>Pros:</strong> Reliable (if one cable fails, only one device is affected), easy to manage.<br><strong>Cons:</strong> If the central hub fails, the entire network goes down.</p>
                        </div>
                        <!-- Bus Topology -->
                        <div class="bg-gray-800 p-4 rounded-lg text-center">
                             <svg viewBox="0 0 100 80" class="w-24 h-24 mx-auto mb-2"><rect x="10" y="38" width="80" height="4" fill="#3B82F6"></rect><path d="M25 38 L 25 20" stroke="#4B5563" stroke-width="1.5"></path><circle cx="25" cy="15" r="5" fill="#D1D5DB"></circle><path d="M50 38 L 50 20" stroke="#4B5563" stroke-width="1.5"></path><circle cx="50" cy="15" r="5" fill="#D1D5DB"></circle><path d="M75 38 L 75 20" stroke="#4B5563" stroke-width="1.5"></path><circle cx="75" cy="15" r="5" fill="#D1D5DB"></circle></svg>
                            <h5 class="font-bold text-lg">Bus</h5>
                             <p class="text-xs text-gray-400 mt-2"><strong>Analogy:</strong> A single main street in a small town. All houses (devices) are connected to this one street.<br><strong>Pros:</strong> Cheap and simple to set up.<br><strong>Cons:</strong> Old technology. If the main cable breaks, the whole network fails. Can be slow with heavy traffic.</p>
                        </div>
                        <!-- Ring Topology -->
                        <div class="bg-gray-800 p-4 rounded-lg text-center">
                            <svg viewBox="0 0 100 80" class="w-24 h-24 mx-auto mb-2"><circle cx="50" cy="40" r="25" stroke="#3B82F6" stroke-width="4" fill="none"></circle><circle cx="50" cy="15" r="5" fill="#D1D5DB"></circle><circle cx="71" cy="29" r="5" fill="#D1D5DB"></circle><circle cx="71" cy="51" r="5" fill="#D1D5DB"></circle><circle cx="29" cy="51" r="5" fill="#D1D5DB"></circle><circle cx="29" cy="29" r="5" fill="#D1D5DB"></circle></svg>
                            <h5 class="font-bold text-lg">Ring</h5>
                            <p class="text-xs text-gray-400 mt-2"><strong>Analogy:</strong> A one-way circular train track. Data (the train) stops at each station (device) in order.<br><strong>Pros:</strong> Orderly data flow, no collisions.<br><strong>Cons:</strong> If one device or a section of the cable fails, the entire ring is broken.</p>
                        </div>
                        <!-- Mesh Topology -->
                         <div class="bg-gray-800 p-4 rounded-lg text-center">
                           <svg viewBox="0 0 100 80" class="w-24 h-24 mx-auto mb-2"><circle cx="50" cy="15" r="5" fill="#D1D5DB"></circle><circle cx="20" cy="35" r="5" fill="#D1D5DB"></circle><circle cx="80" cy="35" r="5" fill="#D1D5DB"></circle><circle cx="35" cy="65" r="5" fill="#D1D5DB"></circle><circle cx="65" cy="65" r="5" fill="#D1D5DB"></circle><path d="M50 15 L 20 35 L 35 65 L 65 65 L 80 35 L 50 15 M20 35 L 80 35 L 50 15 L 65 65 M20 35 L 65 65 M80 35 L 35 65" stroke="#4B5563" stroke-width="1"></path></svg>
                            <h5 class="font-bold text-lg">Mesh</h5>
                            <p class="text-xs text-gray-400 mt-2"><strong>Analogy:</strong> A spider web. Every point is connected to multiple other points, creating many paths.<br><strong>Pros:</strong> Extremely reliable and self-healing. If one path is blocked, data finds another way.<br><strong>Cons:</strong> Very expensive and complex to set up.</p>
                        </div>
                        <!-- Tree Topology -->
                         <div class="bg-gray-800 p-4 rounded-lg text-center">
                            <svg viewBox="0 0 100 80" class="w-24 h-24 mx-auto mb-2"><circle cx="50" cy="15" r="5" fill="#3B82F6"></circle><circle cx="25" cy="40" r="5" fill="#D1D5DB"></circle><circle cx="75" cy="40" r="5" fill="#D1D5DB"></circle><circle cx="15" cy="65" r="5" fill="#D1D5DB"></circle><circle cx="35" cy="65" r="5" fill="#D1D5DB"></circle><circle cx="65" cy="65" r="5" fill="#D1D5DB"></circle><circle cx="85" cy="65" r="5" fill="#D1D5DB"></circle><path d="M50 15 L 25 40 M50 15 L 75 40 M25 40 L 15 65 M25 40 L 35 65 M75 40 L 65 65 M75 40 L 85 65" stroke="#4B5563" stroke-width="1.5"></path></svg>
                            <h5 class="font-bold text-lg">Tree</h5>
                            <p class="text-xs text-gray-400 mt-2"><strong>Analogy:</strong> A family tree. It combines multiple Star topologies onto a Bus backbone.<br><strong>Pros:</strong> Very scalable and easy to expand. Faults are easy to isolate.<br><strong>Cons:</strong> If the main backbone cable fails, large sections of the network go down.</p>
                        </div>
                        <!-- Hybrid Topology -->
                        <div class="bg-gray-800 p-4 rounded-lg text-center">
                            <svg viewBox="0 0 100 80" class="w-24 h-24 mx-auto mb-2"><circle cx="25" cy="20" r="5" fill="#D1D5DB"></circle><circle cx="50" cy="20" r="5" fill="#3B82F6"></circle><circle cx="75" cy="20" r="5" fill="#D1D5DB"></circle><circle cx="25" cy="60" r="5" fill="#D1D5DB"></circle><circle cx="50" cy="60" r="5" fill="#3B82F6"></circle><circle cx="75" cy="60" r="5" fill="#D1D5DB"></circle><path d="M25 20 L 50 20 L 75 20 M25 60 L 50 60 L 75 60 M50 20 L 50 60" stroke="#4B5563" stroke-width="1.5"></path></svg>
                            <h5 class="font-bold text-lg">Hybrid</h5>
                            <p class="text-xs text-gray-400 mt-2"><strong>Analogy:</strong> A city plan. It combines two or more different topologies (e.g., a Star and a Bus) to meet specific needs.<br><strong>Pros:</strong> Flexible, reliable, and scalable.<br><strong>Cons:</strong> Can be complex to manage and expensive.</p>
                        </div>
                    </div>
                </div>

                <!-- TCP/IP vs OSI -->
                <div class="lab-container">
                    <h4 class="text-xl font-bold text-center text-yellow-400">TCP/IP vs. OSI: Blueprint vs. Reality</h4>
                    <p class="text-sm text-center text-gray-400 mb-6">The OSI Model is the detailed 7-layer architect's blueprint; it's a perfect theoretical guide. The TCP/IP Model is the 4-layer practical model that the internet was actually built with. Here's how they relate: (Click a layer to learn more!)</p>
                     <div class="flex justify-center items-stretch gap-4">
                        <!-- OSI Side -->
                        <div class="w-1/2 space-y-2 text-center text-sm font-semibold">
                            <div class="p-2 rounded bg-purple-800 clickable-layer" onclick="showLayerInfo('OSI-7')">7. Application</div>
                            <div class="p-2 rounded bg-pink-800 clickable-layer" onclick="showLayerInfo('OSI-6')">6. Presentation</div>
                            <div class="p-2 rounded bg-teal-800 clickable-layer" onclick="showLayerInfo('OSI-5')">5. Session</div>
                            <div class="p-2 rounded bg-blue-800 clickable-layer" onclick="showLayerInfo('OSI-4')">4. Transport</div>
                            <div class="p-2 rounded bg-green-800 clickable-layer" onclick="showLayerInfo('OSI-3')">3. Network</div>
                            <div class="p-2 rounded bg-yellow-800 clickable-layer" onclick="showLayerInfo('OSI-2')">2. Data Link</div>
                            <div class="p-2 rounded bg-red-800 clickable-layer" onclick="showLayerInfo('OSI-1')">1. Physical</div>
                        </div>
                        <!-- TCP/IP Side -->
                        <div class="w-1/2 space-y-2 text-center text-sm font-semibold">
                            <div class="p-2 rounded bg-purple-600 h-[10.5rem] flex items-center justify-center clickable-layer" onclick="showLayerInfo('TCP-4')">4. Application</div>
                            <div class="p-2 rounded bg-blue-600 clickable-layer" onclick="showLayerInfo('TCP-3')">3. Transport</div>
                            <div class="p-2 rounded bg-green-600 clickable-layer" onclick="showLayerInfo('TCP-2')">2. Internet</div>
                            <div class="p-2 rounded bg-red-600 h-12 flex items-center justify-center clickable-layer" onclick="showLayerInfo('TCP-1')">1. Network Access</div>
                        </div>
                    </div>
                </div>
                
                 <!-- Key Protocols -->
                <div class="lab-container">
                    <h4 class="text-xl font-bold text-center text-yellow-400">Key Protocols: The Languages of the Internet</h4>
                    <p class="text-sm text-center text-gray-400 mb-6">Protocols are sets of rules that govern communication. Think of them as different languages for different jobs. Click on a protocol to learn its secrets!</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <button class="btn btn-secondary" onclick="showProtocolInfo('HTTP')">HTTP</button>
                        <button class="btn btn-secondary" onclick="showProtocolInfo('DNS')">DNS</button>
                        <button class="btn btn-secondary" onclick="showProtocolInfo('SMTP')">SMTP</button>
                        <button class="btn btn-secondary" onclick="showProtocolInfo('FTP')">FTP</button>
                        <button class="btn btn-secondary" onclick="showProtocolInfo('TCP')">TCP</button>
                        <button class="btn btn-secondary" onclick="showProtocolInfo('UDP')">UDP</button>
                    </div>
                </div>

            </article>

            <!-- ULTIMATE LAB -->
            <article id="lab-ultimate-design" class="card">
                <h3 class="text-3xl font-bold mb-4">Ultimate Lab: Network Design Challenge</h3>
                <div id="ultimate-lab-content">
                    <!-- Lab content will be dynamically inserted by JavaScript -->
                </div>
            </article>

        </section>

    </main>

    <!-- Footer -->
    <footer class="text-center p-6 mt-12 bg-gray-900 text-gray-500">
        <p>Created with fun by a Digital Explorer. Happy Networking!</p>
    </footer>

    <!-- Modal for game feedback -->
    <div id="feedback-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title" class="text-2xl font-bold mb-4 text-white text-center">Result</h3>
            <p id="modal-message" class="text-lg mb-6"></p>
            <button id="modal-button" class="btn btn-primary mx-auto block">Continue</button>
        </div>
    </div>


<script>
    const gameContainer = document.getElementById('game-container');
    const modal = document.getElementById('feedback-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalMessage = document.getElementById('modal-message');
    const modalButton = document.getElementById('modal-button');
    modal.onclick = (e) => { if(e.target === modal) modal.style.display = 'none'; };

    let currentLevel = 1;
    let score = 0;
    let gameId = 0;

    function showModal(title, message, callback) {
        modalTitle.textContent = title;
        modalMessage.innerHTML = message;
        modal.style.display = 'flex';
        modalButton.onclick = () => {
            modal.style.display = 'none';
            if (callback) callback();
        };
    }

    // NEW Protocol Info Function
    function showProtocolInfo(protocol) {
        const protocolData = {
            'HTTP': {
                title: 'HTTP - Hypertext Transfer Protocol',
                message: '<strong>Analogy:</strong> The language your browser speaks to a web server to ask for a webpage. It\'s like ordering from a menu in a specific language the waiter understands.<br><br><strong>In-Depth:</strong> HTTP is the foundation of the World Wide Web. It\'s a request-response protocol where your browser (the client) sends a request (e.g., "GET me the main page") and the server sends back a response containing the website\'s content (HTML, images, etc.). It operates at the Application Layer.'
            },
            'DNS': {
                title: 'DNS - Domain Name System',
                message: '<strong>Analogy:</strong> The internet\'s phonebook. You know the name (google.com), but DNS finds the phone number (the IP address) for you.<br><br><strong>In-Depth:</strong> Since humans remember names better than long strings of numbers, DNS translates human-readable domain names into machine-readable IP addresses. This complex, hierarchical system is what allows you to type a simple URL to get to a website. It operates at the Application Layer.'
            },
            'SMTP': {
                title: 'SMTP - Simple Mail Transfer Protocol',
                message: '<strong>Analogy:</strong> The postal service for email. It handles the sending and relaying of your digital mail from your email client to the recipient\'s mail server.<br><br><strong>In-Depth:</strong> SMTP is used exclusively for *sending* emails. When you hit "Send," your email client communicates with your mail server using SMTP. Other protocols like POP3 or IMAP are used for *receiving* emails. It operates at the Application Layer.'
            },
            'FTP': {
                title: 'FTP - File Transfer Protocol',
                message: '<strong>Analogy:</strong> A digital moving truck. It\'s a specialized service designed to move large files or folders from one computer to another over the internet.<br><br><strong>In-Depth:</strong> FTP is one of the oldest internet protocols. It establishes two connections between client and server: one for commands (like "list files" or "get this file") and another for the actual data transfer. While still used, it is often replaced by more secure methods like SFTP (Secure FTP). It operates at the Application Layer.'
            },
            'TCP': {
                title: 'TCP - Transmission Control Protocol',
                message: '<strong>Analogy:</strong> A certified, tracked package delivery. It ensures every single piece of your data arrives in the correct order and without any errors. It will even resend lost pieces.<br><br><strong>In-Depth:</strong> TCP is a connection-oriented protocol that provides reliable, ordered, and error-checked delivery of a stream of data. It uses the "three-way handshake" to establish a connection before sending data. It\'s used for applications where data integrity is paramount, like web browsing, email, and file transfers. It operates at the Transport Layer.'
            },
            'UDP': {
                title: 'UDP - User Datagram Protocol',
                message: '<strong>Analogy:</strong> A postcard. You write a short message, drop it in the mail, and hope it gets there. It\'s fast and simple, but there are no guarantees or tracking.<br><br><strong>In-Depth:</strong> UDP is a connectionless protocol that is very fast but unreliable. It doesn\'t establish a connection before sending and doesn\'t check if the data arrived. This makes it perfect for time-sensitive applications where speed is more important than perfect accuracy, like live video streaming, online gaming, or DNS lookups.'
            }
        };

        const info = protocolData[protocol];
        if (info) {
            showModal(info.title, info.message);
        }
    }
    
    // NEW Layer Info Function
    function showLayerInfo(layerKey) {
        const layerData = {
             'OSI-7': { title: 'OSI Layer 7: Application', message: '<strong>Analogy:</strong> The app\'s menu.<br><br>This is the human-computer interaction layer, where applications can access the network services. It provides protocols that allow software to send and receive information and present meaningful data to users.'},
             'OSI-6': { title: 'OSI Layer 6: Presentation', message: '<strong>Analogy:</strong> The universal translator.<br><br>This layer transforms data into the form that the application layer can accept. It handles data encryption, compression, and translation between different data formats.'},
             'OSI-5': { title: 'OSI Layer 5: Session', message: '<strong>Analogy:</strong> The conversation manager.<br><br>This layer creates, manages, and terminates the communication sessions between two computers. It handles authentication and authorization.'},
             'OSI-4': { title: 'OSI Layer 4: Transport', message: '<strong>Analogy:</strong> The quality control manager.<br><br>This layer provides reliable, end-to-end data transfer. It is responsible for error recovery and flow control. It breaks data into segments and uses protocols like TCP and UDP.'},
             'OSI-3': { title: 'OSI Layer 3: Network', message: '<strong>Analogy:</strong> The GPS and delivery driver.<br><br>This layer is responsible for logical addressing (IP addresses) and routing. It determines the best path for data to travel from source to destination across multiple networks.'},
             'OSI-2': { title: 'OSI Layer 2: Data Link', message: '<strong>Analogy:</strong> The local mail carrier.<br><br>This layer handles communication on the local network segment. It takes packets and encapsulates them into frames, adding the physical MAC addresses. Switches operate here.'},
             'OSI-1': { title: 'OSI Layer 1: Physical', message: '<strong>Analogy:</strong> The roads and the truck.<br><br>This layer is the hardware layer. It defines the physical specifications for devices. It is responsible for transmitting raw bits over a physical medium like cables or Wi-Fi.'},
             'TCP-4': { title: 'TCP/IP Layer 4: Application', message: 'This layer combines the functions of the OSI Application, Presentation, and Session layers. It provides protocols for applications to communicate, such as HTTP for web browsing and SMTP for email.'},
             'TCP-3': { title: 'TCP/IP Layer 3: Transport', message: 'This layer is identical to the OSI Transport Layer. It is responsible for end-to-end communication, using TCP for reliability or UDP for speed.'},
             'TCP-2': { title: 'TCP/IP Layer 2: Internet', message: 'This layer is equivalent to the OSI Network Layer. It is responsible for IP addressing and routing packets across the internet.'},
             'TCP-1': { title: 'TCP/IP Layer 1: Network Access', message: 'This layer combines the OSI Data Link and Physical layers. It deals with all the hardware and protocols for transmitting data on a specific physical network, like Ethernet or Wi-Fi.'},
        };
        const info = layerData[layerKey];
        if (info) {
            showModal(info.title, info.message);
        }
    }

    // --- GAME LOGIC ---
    function loadGame(id) {
        gameId = id;
        currentLevel = 1;
        score = 0;
        switch (id) {
            case 1: startDNSCacheHunt(); break;
            case 2: startIPSorter(); break;
            case 3: startSubnetSlider(); break;
            case 4: startMACMatchUp(); break;
            case 5: startPortMaster(); break;
            case 6: startFirewallChallenge(); break;
        }
    }
    function startFirewallChallenge() {
         const rules = [
            { service: "Secure Web Traffic", protocol: "TCP", port: "443", action: "ALLOW" },
            { service: "Remote Server Login", protocol: "TCP", port: "22", action: "ALLOW" },
            { service: "File Transfer", protocol: "TCP", port: "21", action: "ALLOW" },
            { service: "A suspicious scan", protocol: "ANY", port: "ANY", action: "DENY" }
        ];
        const currentRule = rules[Math.floor(Math.random() * rules.length)];

        gameContainer.innerHTML = `
            <h3 class="text-xl font-bold mb-2">Firewall Challenge</h3>
            <p class="text-sm text-gray-400 mb-4">An incoming packet wants to access your network. Create the correct firewall rule for: <strong class="text-yellow-400">${currentRule.service}</strong></p>
            <div class="grid grid-cols-3 gap-4">
                <div>
                    <label class="block mb-2">Action</label>
                    <select id="fw-action" class="w-full p-2 rounded bg-gray-700 border-gray-600"><option>ALLOW</option><option>DENY</option></select>
                </div>
                <div>
                    <label class="block mb-2">Protocol</label>
                    <select id="fw-protocol" class="w-full p-2 rounded bg-gray-700 border-gray-600"><option>TCP</option><option>UDP</option><option>ANY</option></select>
                </div>
                 <div>
                    <label class="block mb-2">Port</label>
                    <input id="fw-port" type="text" placeholder="e.g., 443" class="w-full p-2 rounded bg-gray-700 border-gray-600">
                </div>
            </div>
            <button class="btn btn-primary w-full mt-6" id="fw-check-btn">Apply Rule</button>
        `;

        document.getElementById('fw-check-btn').addEventListener('click', () => {
            const action = document.getElementById('fw-action').value;
            const protocol = document.getElementById('fw-protocol').value;
            const port = document.getElementById('fw-port').value.trim();

            if(action === currentRule.action && protocol === currentRule.protocol && (port === currentRule.port || currentRule.port === 'ANY')) {
                showModal("Rule Correct!", "You protected the network properly. Let's try another.", startFirewallChallenge);
            } else {
                showModal("Rule Incorrect!", `That rule is wrong. The correct rule was ${currentRule.action} ${currentRule.protocol} ${currentRule.port}. Try again!`);
            }
        });
    }
    function startDNSCacheHunt() { 
        const levels = [
            { "google.com": "172.217.16.174", "facebook.com": "157.240.22.35", "apple.com": "17.253.144.10" },
            { "amazon.com": "205.251.242.103", "netflix.com": "52.85.151.10", "github.com": "140.82.121.4", "twitter.com": "104.244.42.129" },
        ];
        const levelData = levels[currentLevel - 1];
        if (!levelData) {
            showModal("You're a DNS Master!", `You finished all levels!`, () => gameContainer.innerHTML = '<h3 class="text-2xl text-center">Play another game?</h3>');
            return;
        }
        const domains = Object.keys(levelData);
        const targetDomain = domains[Math.floor(Math.random() * domains.length)];
        const correctIp = levelData[targetDomain];
        gameContainer.innerHTML = `
            <h3 class="text-xl font-bold mb-2">DNS Cache Hunt - Level ${currentLevel}</h3>
            <p class="text-sm text-gray-400 mb-4"><strong>How to Play:</strong> Find the IP for <strong class="text-yellow-400">${targetDomain}</strong> in the cache and type it below.</p>
            <div class="bg-gray-800 p-4 rounded-lg mb-4">
                <h4 class="font-bold text-center mb-2">-- DNS CACHE --</h4>
                <div class="grid grid-cols-2 gap-x-4 gap-y-1 text-sm">
                    ${domains.map(domain => `<span>${domain}</span><span class="text-right text-gray-300">${levelData[domain]}</span>`).join('')}
                </div>
            </div>
            <input type="text" id="ip-input" class="w-full p-2 border rounded-md bg-gray-700 text-white border-gray-600" placeholder="Type the IP here...">
            <button class="btn btn-primary mt-6 w-full" id="dns-check-btn">Check IP</button>
        `;
        document.getElementById('dns-check-btn').addEventListener('click', () => {
            const userInput = document.getElementById('ip-input').value.trim();
            if (userInput === correctIp) {
                currentLevel++;
                showModal("Correct!", `You found the right IP!`, startDNSCacheHunt);
            } else {
                showModal("Not Quite!", `That's not the correct IP. Check the cache again!`);
            }
        });
    }
    function startIPSorter() { 
        const levels = [
            ["192.168.0.1", "2001:db8::1", "10.0.0.5", "fe80::a00:27ff:fe8a:885e"],
            ["172.16.254.1", "::1", "8.8.8.8", "2a03:2880::", "127.0.0.1", "2001:4860::8888"],
        ];
        const levelData = levels[currentLevel - 1];
         if (!levelData) {
            showModal("You're an IP Expert!", `You finished all levels!`, () => gameContainer.innerHTML = '<h3 class="text-2xl text-center">Play another game?</h3>');
            return;
        }
        gameContainer.innerHTML = `
            <h3 class="text-xl font-bold mb-2">IP Sorter - Level ${currentLevel}</h3>
            <p class="text-sm text-gray-400 mb-4">Drag the IP addresses to the correct box. IPv4 uses dots, IPv6 uses colons.</p>
            <div id="ip-source" class="flex flex-wrap justify-center gap-4 p-4 bg-gray-900 rounded-lg min-h-[60px]">
                ${levelData.map((ip, index) => `<div id="ip-${index}" draggable="true" class="p-2 bg-gray-700 text-white rounded shadow cursor-grab">${ip}</div>`).join('')}
            </div>
            <div class="grid grid-cols-2 gap-4 mt-6">
                <div id="ipv4-bucket" class="p-4 matte-blue rounded-lg min-h-[100px]"><h4 class="font-bold text-blue-300">IPv4 Addresses</h4></div>
                <div id="ipv6-bucket" class="p-4 matte-green rounded-lg min-h-[100px]"><h4 class="font-bold text-green-300">IPv6 Addresses</h4></div>
            </div>`;
        
        levelData.forEach((ip, index) => {
            const ipElement = document.getElementById(`ip-${index}`);
            ipElement.addEventListener('dragstart', e => e.dataTransfer.setData('text/plain', e.target.id));
        });
        ['ipv4-bucket', 'ipv6-bucket'].forEach(id => {
            const bucket = document.getElementById(id);
            bucket.addEventListener('dragover', e => { e.preventDefault(); bucket.classList.add('bg-gray-700'); });
            bucket.addEventListener('dragleave', () => bucket.classList.remove('bg-gray-700'));
            bucket.addEventListener('drop', e => {
                e.preventDefault();
                bucket.classList.remove('bg-gray-700');
                const droppedId = e.dataTransfer.getData('text');
                const draggedElement = document.getElementById(droppedId);
                if (draggedElement) {
                    bucket.appendChild(draggedElement);
                }
                if (document.getElementById('ip-source').children.length === 0) {
                    checkIPSorterCompletion(levelData.length);
                }
            });
        });
    }
    function checkIPSorterCompletion(totalIps) { 
        let correctCount = 0;
        Array.from(document.getElementById('ipv4-bucket').children).forEach(el => { if (el.textContent.includes('.')) correctCount++; });
        Array.from(document.getElementById('ipv6-bucket').children).forEach(el => { if (el.textContent.includes(':')) correctCount++; });
        
        if (correctCount === totalIps) {
            currentLevel++;
            showModal("Level Complete!", `Perfect sorting!`, startIPSorter);
        } else {
            showModal("Almost!", `You sorted ${correctCount}/${totalIps} correctly. Let's reset and try again.`, startIPSorter);
        }
    }
    function startSubnetSlider() { 
         gameContainer.innerHTML = `
            <h3 class="text-xl font-bold mb-2">Subnet Sandbox</h3>
            <p class="text-sm text-gray-400 mb-4">Adjust the slider to see how the prefix length (subnet mask) affects the number of available hosts in a network.</p>
            <div class="p-4 bg-gray-800 rounded-lg">
                <label for="subnet-slider" class="block font-bold">Prefix Length: <span id="prefix-value">/24</span></label>
                <input type="range" id="subnet-slider" min="16" max="30" value="24" class="w-full mt-2">
                <div class="mt-4 text-center">
                    <p class="text-lg">Available Hosts: <strong id="host-count" class="text-green-400">254</strong></p>
                </div>
            </div>`;
        const slider = document.getElementById('subnet-slider');
        const prefixValue = document.getElementById('prefix-value');
        const hostCount = document.getElementById('host-count');
        slider.addEventListener('input', () => {
            const prefix = slider.value;
            prefixValue.textContent = `/${prefix}`;
            hostCount.textContent = (Math.pow(2, 32 - prefix) - 2).toLocaleString();
        });
    }
    function startMACMatchUp() {
        const items = [ { name: 'Laptop', icon: '💻' }, { name: 'Phone', icon: '📱' }, { name: 'Router', icon: '📡' }, { name: 'Smart TV', icon: '📺' }, { name: 'Printer', icon: '🖨️' }, { name: 'Server', icon: '💾' } ];
        if (currentLevel > 3) {
            showModal("You're a MAC Address Whiz!", "You finished all levels!", () => gameContainer.innerHTML = '<h3 class="text-2xl text-center">Play another game?</h3>');
            return;
        }
        let levelItems = items.slice(0, 2 * (currentLevel + 1));
        const cards = [];
        levelItems.forEach(item => {
            const mac = `00:1A:2B:${Math.floor(Math.random()*90+10)}:${Math.floor(Math.random()*90+10)}:${Math.floor(Math.random()*90+10)}`;
            cards.push({ value: item.name, content: `${item.icon}<br>${item.name}` });
            cards.push({ value: item.name, content: mac });
        });
        cards.sort(() => Math.random() - 0.5);
        gameContainer.innerHTML = `
            <h3 class="text-xl font-bold mb-2">MAC Match-Up - Level ${currentLevel}</h3>
            <p class="text-sm text-gray-400 mb-4">Click cards to find matching pairs of devices and their MAC addresses.</p>
            <div id="mac-grid" class="grid ${currentLevel === 1 ? 'grid-cols-2' : 'grid-cols-4'} gap-4">
            ${cards.map((card) => `
                <div class="game-card h-24 flex items-center justify-center p-2 bg-gray-800 rounded-lg cursor-pointer" data-value="${card.value}" style="perspective: 1000px;">
                    <div class="flipper w-full h-full" style="transition: transform 0.6s; transform-style: preserve-3d;">
                        <div class="front absolute w-full h-full flex items-center justify-center bg-gray-700 rounded-lg text-4xl" style="backface-visibility: hidden;">?</div>
                        <div class="back absolute w-full h-full flex items-center justify-center text-white text-sm" style="backface-visibility: hidden; transform: rotateY(180deg);">${card.content}</div>
                    </div>
                </div>`).join('')}
            </div>`;

        let firstCard = null, lockBoard = false, matchedPairs = 0;
        document.querySelectorAll('.game-card').forEach(card => card.addEventListener('click', () => {
            if (lockBoard || card.classList.contains('matched') || card === firstCard) return;
            card.querySelector('.flipper').style.transform = 'rotateY(180deg)';
            if (!firstCard) { firstCard = card; return; }
            lockBoard = true;
            if (firstCard.dataset.value === card.dataset.value) {
                [firstCard, card].forEach(c => c.classList.add('matched'));
                matchedPairs++;
                [firstCard, lockBoard] = [null, false];
                if (matchedPairs === levelItems.length) {
                    currentLevel++;
                    showModal("Level Complete!", "You've matched them all!", startMACMatchUp);
                }
            } else {
                setTimeout(() => {
                    [firstCard, card].forEach(c => c.querySelector('.flipper').style.transform = '');
                    [firstCard, lockBoard] = [null, false];
                }, 1200);
            }
        }));
    }
    function startPortMaster() {
        const portsData = { '80': 'HTTP (Web)', '443': 'HTTPS (Secure Web)', '21': 'FTP (Files)', '22': 'SSH (Secure Shell)', '25': 'SMTP (Email)', '53': 'DNS' };
        const allPorts = Object.keys(portsData);
        if (currentLevel > 3) {
             showModal("You're a Port Master!", "You've finished all levels!", () => gameContainer.innerHTML = '<h3 class="text-2xl text-center">Play another game?</h3>');
             return;
        }
        let targetPort = allPorts[Math.floor(Math.random() * allPorts.length)];
        let displayPorts = [targetPort];
        while (displayPorts.length < currentLevel + 2) {
            let p = allPorts[Math.floor(Math.random() * allPorts.length)];
            if (!displayPorts.includes(p)) displayPorts.push(p);
        }
        displayPorts.sort(() => Math.random() - 0.5);

        gameContainer.innerHTML = `
            <h3 class="text-xl font-bold mb-2">Port Master - Level ${currentLevel}</h3>
            <p class="text-sm text-gray-400 mb-4">A service request is coming in! Click the correct port for that service.</p>
            <div class="p-4 bg-yellow-900 bg-opacity-50 text-yellow-300 font-bold text-xl rounded-lg mb-6 text-center">Request for: ${portsData[targetPort]}</div>
            <div id="ports-grid" class="grid grid-cols-3 gap-4">
                ${displayPorts.map(p => `<button class="p-6 bg-blue-900 bg-opacity-50 border border-blue-700 rounded-lg font-bold hover:bg-blue-800" onclick="checkPort('${p}', '${targetPort}')">${p}</button>`).join('')}
            </div>`;
    }
    function checkPort(clicked, correct) {
        if (clicked === correct) {
            currentLevel++;
            showModal("Correct!", "You've opened the right port!", startPortMaster);
        } else {
            showModal("Incorrect!", `That's the wrong port. Let's try another request.`, startPortMaster);
        }
    }


    /* --- OSI Lab Logic --- */
    document.addEventListener('DOMContentLoaded', () => {
        const osiDraggables = document.querySelectorAll('#osi-lab-source div');
        const osiBuckets = document.querySelectorAll('#osi-lab-buckets div');
        const osiFeedback = document.getElementById('osi-lab-feedback');

        const osiAnswers = {
            "HTTP": "Application", "TCP": "Transport", "IP": "Network", "Ethernet": "Data Link", "Wi-Fi Signals": "Physical"
        };

        osiDraggables.forEach(draggable => {
            draggable.addEventListener('dragstart', e => {
                e.dataTransfer.setData('text/plain', e.target.textContent);
            });
        });

        osiBuckets.forEach(bucket => {
            bucket.addEventListener('dragover', e => e.preventDefault());
            bucket.addEventListener('drop', e => {
                e.preventDefault();
                const data = e.dataTransfer.getData('text');
                const draggableElement = Array.from(osiDraggables).find(d => d.textContent === data);
                
                if (draggableElement && osiAnswers[data] === bucket.dataset.layer) {
                    bucket.appendChild(draggableElement);
                    draggableElement.classList.add('bg-green-700');
                    osiFeedback.textContent = 'Correct!';
                    osiFeedback.classList.remove('text-red-400');
                    osiFeedback.classList.add('text-green-400');
                } else {
                    osiFeedback.textContent = `Not quite! ${data} doesn't belong there.`;
                    osiFeedback.classList.remove('text-green-400');
                    osiFeedback.classList.add('text-red-400');
                }
                setTimeout(() => osiFeedback.textContent = '', 2000);
            });
        });
        
        populatePacketTraceQuestions();
        loadUltimateLabLevel(0); // Load the first level of the ultimate lab
    });

    /* --- IP Subnet Calculator Logic --- */
    function calculateSubnet() {
        const ipInput=document.getElementById('ip-calc-input').value;const cidrInput=parseInt(document.getElementById('ip-calc-cidr').value,10);const resultsDiv=document.getElementById('ip-calc-results');if(!/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/.test(ipInput)||isNaN(cidrInput)||cidrInput<0||cidrInput>32){resultsDiv.textContent="Error: Please enter a valid IPv4 address and a CIDR prefix (0-32).";return}
        const ipParts=ipInput.split('.').map(Number);if(ipParts.some(part=>part<0||part>255)){resultsDiv.textContent="Error: Each part of the IP address must be between 0 and 255.";return}
        const ipAsInt=(ipParts[0]<<24)|(ipParts[1]<<16)|(ipParts[2]<<8)|ipParts[3];const subnetMaskInt=(-1<<(32-cidrInput))>>>0;const networkAddressInt=(ipAsInt&subnetMaskInt)>>>0;const broadcastAddressInt=(networkAddressInt|~subnetMaskInt)>>>0;const intToIp=(int)=>`${(int>>>24)}.${(int>>16)&255}.${(int>>8)&255}.${int&255}`;const networkAddress=intToIp(networkAddressInt);const broadcastAddress=intToIp(broadcastAddressInt);const subnetMask=intToIp(subnetMaskInt);const firstHost=cidrInput<31?intToIp(networkAddressInt+1):'N/A';const lastHost=cidrInput<31?intToIp(broadcastAddressInt-1):'N/A';const totalHosts=cidrInput<31?Math.pow(2,32-cidrInput)-2:0;resultsDiv.textContent=`Address:          ${ipInput}/${cidrInput}\nNetwork Address:  ${networkAddress}\nBroadcast Address: ${broadcastAddress}\nSubnet Mask:      ${subnetMask}\nFirst Host:       ${firstHost}\nLast Host:        ${lastHost}\nUsable Hosts:     ${totalHosts.toLocaleString()}`
    }


    /* --- Packet Trace Lab Logic with Enhanced Feedback --- */
    const traceQuestions = [
        { id: 'q1', layer: 'Data Link', color: 'yellow', label: 'Layer 2 (Data Link): What is the destination MAC address?', answer: '1A:2B:3C:4D:5E:6F' },
        { id: 'q2', layer: 'Network', color: 'green', label: 'Layer 3 (Network): What is the destination IP address?', answer: '93.184.216.34' },
        { id: 'q3', layer: 'Transport', color: 'blue', label: 'Layer 4 (Transport): What is the destination Port?', answer: '80' },
        { id: 'q4', layer: 'Application', color: 'purple', label: 'Layer 7 (Application): What file is being requested?', answer: '/index.html' }
    ];

    function populatePacketTraceQuestions() {
        const grid = document.getElementById('trace-analysis-grid');
        grid.innerHTML = '';
        traceQuestions.forEach(q => {
            const div = document.createElement('div');
            div.innerHTML = `
                <label class="font-bold text-${q.color}-400">${q.label}</label>
                <input type="text" id="trace-${q.id}" class="w-full mt-1 p-2 bg-gray-700 border border-gray-600 rounded" placeholder="Your answer...">
                <p id="feedback-${q.id}" class="text-xs mt-1 h-8"></p>
            `;
            grid.appendChild(div);
        });
    }

    function checkPacketTrace() {
        let allCorrect = true;
        traceQuestions.forEach(q => {
            const input = document.getElementById(`trace-${q.id}`);
            const feedback = document.getElementById(`feedback-${q.id}`);
            const userAnswer = input.value.trim();
            const correctAnswer = q.answer;

            if (userAnswer.localeCompare(correctAnswer, undefined, { sensitivity: 'base' }) === 0) {
                feedback.textContent = 'Correct!';
                feedback.className = 'text-xs mt-1 h-8 text-green-400';
                input.classList.remove('border-red-500');
                input.classList.add('border-green-500');
            } else {
                let explanation = '';
                if(q.id === 'q1') explanation = 'This is the hardware address of the next hop (the router).';
                if(q.id === 'q2') explanation = 'This is the public address of the web server.';
                if(q.id === 'q3') explanation = 'Port 80 is standard for HTTP web traffic.';
                if(q.id === 'q4') explanation = 'The user is requesting the main page of the site.';
                
                feedback.innerHTML = `Incorrect. The answer is <strong class="text-white">${correctAnswer}</strong>. ${explanation}`;
                feedback.className = 'text-xs mt-1 h-8 text-red-400';
                input.classList.add('border-red-500');
                input.classList.remove('border-green-500');
                allCorrect = false;
            }
        });

        if(allCorrect) {
            showModal("Analysis Complete!", "Excellent work, Detective! You've successfully dissected the packet.");
        }
    }

    /* --- Ultimate Lab Logic (Multi-Level) --- */
    const ultimateLabScenarios = [
        {
            level: 1,
            scenario: "You are the new Network Engineer for a startup with 3 departments: Engineering (50 devices), Sales (25 devices), and Management (10 devices). You've_been given the IP block <code class='bg-gray-800 p-1 rounded'>10.10.0.0/24</code>.",
            topology: { question: "Considering scalability and ease of management, which topology is best for a modern office environment?", answer: "Star", hint: "Think about which design uses a central device like a switch to make adding new computers easy." },
            subnet: { question: "Using the <code class='bg-gray-800 p-1 rounded'>10.10.0.0/24</code> block, calculate the correct CIDR prefix for each department's subnet.", departments: [{name: "Engineering", devices: 50, answer: "26"}, {name: "Sales", devices: 25, answer: "27"}, {name: "Management", devices: 10, answer: "28"}], hint: "Remember: 2^(32-prefix) >= (devices + 2). A /26 gives 64 addresses, /27 gives 32, and /28 gives 16." },
            protocol: { question: "A user in the Sales department sends an email to a client. What is the primary protocol used at each layer for this action?", appAnswer: "SMTP", transportAnswer: "TCP", hint: "Email needs reliable, guaranteed delivery. Which transport protocol provides that? What's the specific protocol for *sending* mail?" }
        },
        {
            level: 2,
            scenario: "The company is expanding to a second building across the street. You need to connect the two buildings. The new building needs a network for a new R&D department of 100 devices. You have the IP block <code class='bg-gray-800 p-1 rounded'>172.16.0.0/23</code>.",
            topology: { question: "What is the most suitable topology to connect the two office buildings and their internal networks?", answer: "Tree", hint: "Think of a hierarchy. You have a main connection (the backbone) and individual networks branching off from it." },
            subnet: { question: "From the <code class='bg-gray-800 p-1 rounded'>172.16.0.0/23</code> block, what is the most efficient CIDR prefix for the new R&D department of 100 devices?", departments: [{name: "R&D", devices: 100, answer: "25"}], hint: "You need at least 102 addresses (100 for hosts + network + broadcast). A /25 provides 128 addresses." },
            protocol: { question: "An R&D user is on a live video conference call. What are the most likely protocols being used?", appAnswer: "RTP", transportAnswer: "UDP", hint: "Live video prioritizes speed over perfect reliability. What transport protocol is best for that? The Application protocol often used is Real-time Transport Protocol." }
        },
        {
            level: 3,
            scenario: "The company now has a high-availability data center with critical servers that must always be online. Maximum reliability is the absolute top priority.",
            topology: { question: "For the new data center where uptime is critical, which topology provides the most redundancy and fault tolerance?", answer: "Mesh", hint: "Which topology provides multiple paths for data to travel, so if one link fails, another can be used instantly?" },
            subnet: { question: "You need to create a very small subnet just for two routers to talk to each other. What is the most efficient CIDR prefix for a point-to-point link?", departments: [{name: "Router-Link", devices: 2, answer: "30"}], hint: "A point-to-point link only needs 2 usable IP addresses. Which prefix provides exactly 4 total addresses (2 usable + network + broadcast)?" },
            protocol: { question: "A server needs to find the IP address for `api.partner.com`. What protocols are used for this lookup?", appAnswer: "DNS", transportAnswer: "UDP", hint: "What is the internet's 'phonebook' protocol? It's designed to be a very fast, simple request-response, so it often uses the faster transport protocol." }
        }
    ];

    let ultimateLabCurrentLevel = 0;
    let labPartsCorrect = { topology: false, subnet: false, protocol: false };

    function loadUltimateLabLevel(level) {
        ultimateLabCurrentLevel = level;
        labPartsCorrect = { topology: false, subnet: false, protocol: false };
        const scenario = ultimateLabScenarios[level];
        const labContent = document.getElementById('ultimate-lab-content');

        const subnetInputs = scenario.subnet.departments.map(dept => `
            <div>
                <label class="font-bold">${dept.name} (${dept.devices} devices)</label>
                <input type="text" id="subnet-${dept.name.replace(/\s+/g, '-').toLowerCase()}" class="w-full text-center mt-1 p-2 bg-gray-700 border border-gray-600 rounded" placeholder="/?">
            </div>
        `).join('');

        labContent.innerHTML = `
            <p class="text-gray-300 mb-4"><strong>Level ${scenario.level}:</strong> ${scenario.scenario}</p>
            
            <div class="lab-container">
                <h4 class="text-xl font-bold text-center text-yellow-400">Part 1: Network Topology</h4>
                <p class="text-sm text-center text-gray-400 mb-4">${scenario.topology.question}</p>
                <div id="topo-choices" class="flex flex-wrap justify-center gap-4">
                    <button class="btn btn-secondary" onclick="checkTopology(this, 'Bus')">Bus</button>
                    <button class="btn btn-secondary" onclick="checkTopology(this, 'Ring')">Ring</button>
                    <button class="btn btn-secondary" onclick="checkTopology(this, 'Star')">Star</button>
                    <button class="btn btn-secondary" onclick="checkTopology(this, 'Tree')">Tree</button>
                    <button class="btn btn-secondary" onclick="checkTopology(this, 'Mesh')">Mesh</button>
                </div>
                <div class="flex justify-center gap-4">
                    <button class="text-xs text-gray-500 mt-4" onclick="showHint('topo-hint')">Stuck? Get a Hint!</button>
                    <button class="text-xs text-yellow-500 mt-4" onclick="showSolution('topology')">Show Solution</button>
                </div>
                <p id="topo-hint" class="text-center text-sm text-blue-400 mt-2 hidden">${scenario.topology.hint}</p>
                <p id="topo-solution" class="text-center text-sm bg-gray-900 p-2 rounded mt-2 hidden"></p>
                <p id="topo-feedback" class="text-center mt-4 h-4"></p>
            </div>

            <div class="lab-container">
                <h4 class="text-xl font-bold text-center text-yellow-400">Part 2: IP Subnetting Challenge</h4>
                <p class="text-sm text-center text-gray-400 mb-4">${scenario.subnet.question}</p>
                <div class="grid grid-cols-1 md:grid-cols-${scenario.subnet.departments.length} gap-4 text-center">
                    ${subnetInputs}
                </div>
                 <div class="flex justify-center gap-4">
                    <button class="text-xs text-gray-500 mt-4" onclick="showHint('subnet-hint')">Stuck? Get a Hint!</button>
                    <button class="text-xs text-yellow-500 mt-4" onclick="showSolution('subnetting')">Show Solution</button>
                </div>
                <p id="subnet-hint" class="text-center text-sm text-blue-400 mt-2 hidden">${scenario.subnet.hint}</p>
                <p id="subnet-solution" class="text-center text-sm bg-gray-900 p-2 rounded mt-2 hidden"></p>
                <button class="btn btn-primary w-full mt-6" onclick="checkSubnetting()">Check Subnets</button>
                <p id="subnet-feedback" class="text-center mt-4 h-4"></p>
            </div>
            
            <div class="lab-container">
                <h4 class="text-xl font-bold text-center text-yellow-400">Part 3: Protocol Analysis</h4>
                <p class="text-sm text-center text-gray-400 mb-4">${scenario.protocol.question}</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="font-bold">Application Layer Protocol:</label>
                        <input type="text" id="proto-app" class="w-full mt-1 p-2 bg-gray-700 border border-gray-600 rounded" placeholder="e.g., HTTP, SMTP, DNS...">
                    </div>
                    <div>
                        <label class="font-bold">Transport Layer Protocol:</label>
                        <input type="text" id="proto-transport" class="w-full mt-1 p-2 bg-gray-700 border border-gray-600 rounded" placeholder="e.g., TCP, UDP...">
                    </div>
                </div>
                <div class="flex justify-center gap-4">
                    <button class="text-xs text-gray-500 mt-4" onclick="showHint('proto-hint')">Stuck? Get a Hint!</button>
                    <button class="text-xs text-yellow-500 mt-4" onclick="showSolution('protocol')">Show Solution</button>
                </div>
                <p id="proto-hint" class="text-center text-sm text-blue-400 mt-2 hidden">${scenario.protocol.hint}</p>
                <p id="proto-solution" class="text-center text-sm bg-gray-900 p-2 rounded mt-2 hidden"></p>
                <button class="btn btn-primary w-full mt-6" onclick="checkProtocols()">Check Protocols</button>
                <p id="proto-feedback" class="text-center mt-4 h-4"></p>
            </div>
            <div id="next-level-container" class="text-center mt-8"></div>
        `;
    }

    function checkAllParts() {
        if (labPartsCorrect.topology && labPartsCorrect.subnet && labPartsCorrect.protocol) {
            const nextLevelContainer = document.getElementById('next-level-container');
            if (ultimateLabCurrentLevel < ultimateLabScenarios.length - 1) {
                nextLevelContainer.innerHTML = `<button class="btn btn-primary" onclick="loadUltimateLabLevel(${ultimateLabCurrentLevel + 1})">Proceed to Level ${ultimateLabCurrentLevel + 2}!</button>`;
            } else {
                 nextLevelContainer.innerHTML = `<p class="text-2xl font-bold text-green-400">Congratulations! You have completed the Network Design Challenge!</p>`;
            }
        }
    }
    
    function showHint(id) {
        document.getElementById(id).classList.remove('hidden');
    }

    function showSolution(part) {
        const scenario = ultimateLabScenarios[ultimateLabCurrentLevel];
        let solutionText = '';
        let solutionElement;

        switch (part) {
            case 'topology':
                solutionElement = document.getElementById('topo-solution');
                let topoExplanation = '';
                if (scenario.topology.answer === 'Star') topoExplanation = 'The Star topology is best for an office because all devices connect to a central switch. This makes it easy to add new users, and a single cable failure won’t bring down the entire network, only one user.';
                else if (scenario.topology.answer === 'Tree') topoExplanation = 'A Tree topology is ideal here as it creates a hierarchical network. The two buildings act as major branches connected by a main backbone, while the internal networks in each building are their own Star topologies.';
                else if (scenario.topology.answer === 'Mesh') topoExplanation = 'A Mesh topology provides maximum redundancy by connecting every server to every other server. This ensures that if any single connection fails, data can be instantly rerouted, which is critical for a data center.';
                solutionText = `<strong>Solution:</strong> The correct topology is <strong>${scenario.topology.answer}</strong>.<br><strong>Explanation:</strong> ${topoExplanation}`;
                break;
            case 'subnetting':
                solutionElement = document.getElementById('subnet-solution');
                const deptAnswers = scenario.subnet.departments.map(d => `<strong>${d.name}:</strong> /${d.answer}`).join(', ');
                solutionText = `<strong>Solutions:</strong> ${deptAnswers}.<br><strong>Explanation:</strong> You must find the smallest subnet that can fit the required number of devices plus two extra addresses (for the network and broadcast addresses). For example, Engineering needs 50 devices, so it needs a subnet with at least 52 addresses. A /26 prefix provides 64 addresses, making it the most efficient choice.`;
                break;
            case 'protocol':
                solutionElement = document.getElementById('proto-solution');
                let protoExplanation = '';
                if (scenario.level === 1) protoExplanation = 'The task is sending email, which requires the <strong>SMTP</strong> protocol at the Application layer. Since email must be delivered reliably and in order, it uses the <strong>TCP</strong> protocol at the Transport layer.';
                else if (scenario.level === 2) protoExplanation = 'Live video conferencing prioritizes speed over perfect data integrity. Dropped frames are better than long delays. Therefore, it uses the fast but unreliable <strong>UDP</strong> at the Transport layer. The Application protocol is typically <strong>RTP</strong> (Real-time Transport Protocol).';
                else if (scenario.level === 3) protoExplanation = 'The process of looking up an IP address for a domain name is handled by <strong>DNS</strong> at the Application layer. DNS lookups need to be extremely fast, so they use the lightweight <strong>UDP</strong> at the Transport layer.';
                solutionText = `<strong>Solutions:</strong> Application: <strong>${scenario.protocol.appAnswer}</strong>, Transport: <strong>${scenario.protocol.transportAnswer}</strong>.<br><strong>Explanation:</strong> ${protoExplanation}`;
                break;
        }

        if (solutionElement) {
            solutionElement.innerHTML = solutionText;
            solutionElement.classList.remove('hidden');
        }
    }
    
    function checkTopology(button, choice) {
        const scenario = ultimateLabScenarios[ultimateLabCurrentLevel];
        const feedback = document.getElementById('topo-feedback');
        const buttons = document.querySelectorAll('#topo-choices button');
        buttons.forEach(b => b.classList.remove('bg-green-600', 'bg-red-600'));
        
        if (choice === scenario.topology.answer) {
            feedback.textContent = 'Correct!';
            feedback.className = "text-center mt-4 h-4 text-green-400";
            button.classList.add('bg-green-600');
            labPartsCorrect.topology = true;
        } else {
            feedback.textContent = `Incorrect. ${choice} is not the best fit for this scenario.`;
            feedback.className = "text-center mt-4 h-4 text-red-400";
            button.classList.add('bg-red-600');
            labPartsCorrect.topology = false;
        }
        checkAllParts();
    }

    function checkSubnetting() {
        const scenario = ultimateLabScenarios[ultimateLabCurrentLevel];
        let allCorrect = true;
        const feedback = document.getElementById('subnet-feedback');

        scenario.subnet.departments.forEach(dept => {
            const input = document.getElementById(`subnet-${dept.name.replace(/\s+/g, '-').toLowerCase()}`);
            const userAnswer = input.value.replace('/', '').trim();
            if(userAnswer !== dept.answer) {
                input.classList.add('border-red-500');
                allCorrect = false;
            } else {
                 input.classList.remove('border-red-500');
                 input.classList.add('border-green-500');
            }
        });

        if (allCorrect) {
            feedback.textContent = 'Perfect!';
            feedback.className = "text-center mt-4 h-4 text-green-400";
            labPartsCorrect.subnet = true;
        } else {
            feedback.textContent = 'Not quite. Check the red boxes and the hint.';
            feedback.className = "text-center mt-4 h-4 text-red-400";
            labPartsCorrect.subnet = false;
        }
        checkAllParts();
    }

    function checkProtocols() {
        const scenario = ultimateLabScenarios[ultimateLabCurrentLevel];
        const answers = {
            app: document.getElementById('proto-app').value.trim().toUpperCase(),
            transport: document.getElementById('proto-transport').value.trim().toUpperCase()
        };
        const correctAnswers = { app: scenario.protocol.appAnswer.toUpperCase(), transport: scenario.protocol.transportAnswer.toUpperCase() };
        let allCorrect = true;
        const feedback = document.getElementById('proto-feedback');

        Object.keys(answers).forEach(key => {
            const input = document.getElementById(`proto-${key}`);
            if(answers[key] !== correctAnswers[key]) {
                input.classList.add('border-red-500');
                allCorrect = false;
            } else {
                 input.classList.remove('border-red-500');
                 input.classList.add('border-green-500');
            }
        });

         if (allCorrect) {
            feedback.textContent = 'Correct!';
            feedback.className = "text-center mt-4 h-4 text-green-400";
            labPartsCorrect.protocol = true;
        } else {
            feedback.textContent = 'Almost. Check the red boxes and the hint.';
            feedback.className = "text-center mt-4 h-4 text-red-400";
            labPartsCorrect.protocol = false;
        }
        checkAllParts();
    }
</script>
</body>
</html>

